# Идемпотетность и коммутативность

Реализация идемпотентности для метода создания заказа в API.

Используемый паттерн - "Идемпотентность для коллекций".

Для реализации идемпотентности взаимодействие между клиентом и сервером происходит с передачей заголовков `ETag` и `If-Match`.

Сервер присылает заголовок `ETag` с версией коллекции `orders`.
Клиент при изменении коллекции заголовок `If-Match` с версией, которую он знает.

```
/api/v1/orders/
Etag: 42
```

Сервер проверяет: если `If-Match` совпадает с версией на сервере, то запрос проходит. Если нет, то отвечает ошибкой.

```
POST /api/v1/orders/
If-Match: 42
429 Conflict 
```

Для защиты от повторного запроса в коллекцию, передается хэш состояния – хэш от `max(order_id)`.
